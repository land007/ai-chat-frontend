version: '3.8'

services:
  ai-chat-app:
    image: land007/ai-chat-app:latest
    container_name: ai-chat-app
    ports:
      - "3000:3000"
    volumes:
      # 映射企业微信域名验证文件
      - ./public/WW_verify_XXXXXXXXXXXXXXX.txt:/app/public/WW_verify_XXXXXXXXXXXXXXX.txt:ro
    environment:
      - NODE_ENV=production
      - PORT=3000
      # 应用配置
      - APP_NAME=${APP_NAME:-AI智能助手}
      - APP_DESCRIPTION=${APP_DESCRIPTION:-基于阿里云DashScope的智能对话}
      - WELCOME_MESSAGE=${WELCOME_MESSAGE:-}
      - EXAMPLE_QUESTIONS=${EXAMPLE_QUESTIONS:-}
      - CONTEXT_MESSAGE_COUNT=${CONTEXT_MESSAGE_COUNT:-5}
      # 阿里云DashScope API配置
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY:-your_api_key_here}
      - DASHSCOPE_API_URL=${DASHSCOPE_API_URL:-https://dashscope.aliyuncs.com/api/v1/apps/your_app_id/completion}
      
      # 认证开关和用户配置
      - ENABLE_AUTH=${ENABLE_AUTH:-true}
      - BASIC_AUTH_USERS=${BASIC_AUTH_USERS:-admin:admin123}
      
      # 企业微信认证配置（可选）
      - WEWORK_CORP_ID=${WEWORK_CORP_ID}
      - WEWORK_AGENT_ID=${WEWORK_AGENT_ID}
      - WEWORK_CORP_SECRET=${WEWORK_CORP_SECRET}
      - WEWORK_REDIRECT_URI=${WEWORK_REDIRECT_URI}
      
      # JWT配置
      - JWT_SECRET=${JWT_SECRET}
      
      # UI功能控制
      - ENABLE_I18N_BUTTON=${ENABLE_I18N_BUTTON:-false}
      - ENABLE_DEBUG_MODE=${ENABLE_DEBUG_MODE:-false}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - ai-chat-network

networks:
  ai-chat-network:
    driver: bridge
