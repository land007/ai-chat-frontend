# 企业微信域名验证文件

## 📁 验证文件位置

**文件路径**：`/home/ubuntu/project/gjxt-oa/ai-chat-frontend/public/WW_verify_XXXXXXXXXXXXXXX.txt`

**访问URL**：`http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt`

**文件内容**：`WW_verify_XXXXXXXXXXXXXXX.txt`

## 🔧 技术实现

### 1. Docker配置

#### docker-compose.yml
```yaml
services:
  ai-chat-app:
    image: land007/ai-chat-app:latest
    container_name: ai-chat-app
    ports:
      - "3000:3000"
    volumes:
      # 映射企业微信域名验证文件
      - ./public/WW_verify_XXXXXXXXXXXXXXX.txt:/app/public/WW_verify_XXXXXXXXXXXXXXX.txt:ro
```

#### docker-compose.prod.yml
```yaml
services:
  ai-chat-app:
    image: land007/ai-chat-app:latest
    container_name: ai-chat-app-prod
    ports:
      - "80:3000"
    volumes:
      # 映射企业微信域名验证文件
      - ./public/WW_verify_XXXXXXXXXXXXXXX.txt:/app/public/WW_verify_XXXXXXXXXXXXXXX.txt:ro
```

### 2. 静态文件服务配置

在 `server.js` 中添加了专门的验证文件路由：

```javascript
// 企业微信域名验证文件 - 优先处理
app.get('/WW_verify_XXXXXXXXXXXXXXX.txt', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'WW_verify_XXXXXXXXXXXXXXX.txt'));
});

// 静态文件服务 - 用于企业微信域名验证
app.use(express.static(path.join(__dirname, 'public')));
```

### 3. 文件结构

```
ai-chat-frontend/
├── public/
│   └── WW_verify_XXXXXXXXXXXXXXX.txt  # 企业微信验证文件
├── server.js                            # 服务器文件
└── ...
```

### 4. 访问路径

- **本地测试**：`http://localhost:3000/WW_verify_XXXXXXXXXXXXXXX.txt`
- **生产环境**：`http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt`

## ✅ 验证步骤

### 1. 确认文件可访问

```bash
# 本地测试
curl http://localhost:3000/WW_verify_XXXXXXXXXXXXXXX.txt

# 生产环境测试
curl http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt
```

**期望输出**：`WW_verify_XXXXXXXXXXXXXXX.txt`

### 2. 企业微信后台验证

1. 登录企业微信管理后台
2. 进入 **应用管理** → 找到你的应用
3. 在 **可信域名** 设置中
4. 输入域名：`your-domain.com`
5. 点击 **验证域名**
6. 系统会自动访问验证文件进行验证

## 🚨 注意事项

### 1. 文件权限
确保验证文件有正确的读取权限：

```bash
chmod 644 public/WW_verify_XXXXXXXXXXXXXXX.txt
```

### 2. 服务器配置
确保服务器能正常提供静态文件服务：

```javascript
// 在server.js中已配置
app.use('/verify', express.static(path.join(__dirname, 'public')));
```

### 3. 域名解析
确保 `your-domain.com` 正确解析到服务器IP：

```bash
# 检查域名解析
nslookup your-domain.com
```

### 4. HTTPS支持
如果使用HTTPS，确保验证文件也能通过HTTPS访问：

```bash
# HTTPS访问测试
curl https://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt
```

## 🔄 更新验证文件

如果企业微信要求更新验证文件：

1. **更新文件内容**：
   ```bash
   echo "新的验证码" > public/WW_verify_XXXXXXXXXXXXXXX.txt
   ```

2. **重启服务**：
   ```bash
   # 如果使用PM2
   pm2 restart ai-chat-server
   
   # 如果使用Docker
   docker-compose restart
   ```

3. **验证访问**：
   ```bash
   curl http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt
   ```

## 🐳 Docker部署

### 1. 启动容器
```bash
# 开发环境
docker-compose up -d

# 生产环境
docker-compose -f docker-compose.prod.yml up -d
```

### 2. 验证文件映射
```bash
# 检查文件是否正确映射
docker exec ai-chat-app ls -la /app/public/WW_verify_XXXXXXXXXXXXXXX.txt

# 检查文件内容
docker exec ai-chat-app cat /app/public/WW_verify_XXXXXXXXXXXXXXX.txt
```

### 3. 测试访问
```bash
# 测试容器内访问
docker exec ai-chat-app curl http://localhost:3000/WW_verify_XXXXXXXXXXXXXXX.txt

# 测试外部访问
curl http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt
```

## 📋 检查清单

- [ ] 验证文件已创建：`public/WW_verify_XXXXXXXXXXXXXXX.txt`
- [ ] 文件内容正确：`WW_verify_XXXXXXXXXXXXXXX.txt`
- [ ] Docker volumes映射已配置：`./public/WW_verify_XXXXXXXXXXXXXXX.txt:/app/public/WW_verify_XXXXXXXXXXXXXXX.txt:ro`
- [ ] 静态文件服务已配置：专门的路由处理
- [ ] 本地测试通过：`http://localhost:3000/WW_verify_XXXXXXXXXXXXXXX.txt`
- [ ] 生产环境测试通过：`http://your-domain.com/WW_verify_XXXXXXXXXXXXXXX.txt`
- [ ] Docker容器内文件映射正确
- [ ] 企业微信后台域名验证通过
- [ ] 可信域名已添加：`your-domain.com`

## 🔗 相关链接

- [企业微信域名验证文档](https://developer.work.weixin.qq.com/document/path/91120)
- [企业微信应用管理](https://work.weixin.qq.com/wework_admin/frame#apps)
